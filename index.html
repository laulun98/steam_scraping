<!DOCTYPE html>
<html>
<head>
    <title>Steam Scraper</title>
</head>
<body>
    <button id="btn">Cargar datos</button>
    <pre id="output"></pre>

<script>

document.getElementById('btn').addEventListener('click', ()=>{

    fetch("/.netlify/functions/friendList.js")
    .then(r => r.json())
    .then(data => {

        console.log(data)

        data.friendslist.friends.forEach(friend => {
            botonUsuario(friend)
        });

    })
    .catch(err => console.error("Error:", err))

})

function botonUsuario(friend){

    let id = friend.steamid

    let boton = document.createElement('div')
    boton.style.width = '150px'
    boton.style.height = '20px'
    boton.style.border = '1px solid black'
    boton.style.margin = '5px'
    boton.style.padding = '3px'
    boton.innerHTML = id

    document.body.appendChild(boton)

    boton.addEventListener('click', ()=>{

        fetch("/.netlify/functions/friendInfo.js", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ steamid: id })
        })
        .then(r => r.json())
        .then(data => {

            let datos = JSON.stringify(data, null, 2)
            document.getElementById('output').textContent = datos

        })
        .catch(err => console.error("Error:", err))

    })

}

</script>

</body>
</html>